<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>ZenCraft</title><meta name="viewport" content="width=device-width,initial-scale=1"/><style>html,body{margin:0;height:100%;background:#111;overflow:hidden;font-family:sans-serif;color:#fff}canvas{display:block}#hud{position:fixed;left:12px;top:12px;z-index:60;background:rgba(0,0,0,.5);color:#b0e0e6;padding:10px 15px;border-radius:12px;font-family:monospace;font-size:14px;min-width:180px}#notification{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#a8dadc;color:#1d3557;padding:12px 24px;border-radius:12px;font-size:20px;font-weight:700;opacity:0;transition:opacity .4s;z-index:90}#start-screen{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#1d3557,#457b9d,#a8dadc);background-size:300% 300%;animation:grad 10s ease infinite}@keyframes grad{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}#load-world-button{padding:12px 24px;font-size:18px;background:#a8dadc;color:#1d3557;border:none;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.3);cursor:pointer;font-weight:700}#controls-ui{position:fixed;left:0;right:0;bottom:0;display:none;justify-content:space-between;padding:20px;z-index:45}.joy-bg{width:100%;height:100%;background:rgba(255,255,255,.08);border-radius:50%}.joy-knob{width:40px;height:40px;background:rgba(255,255,255,.25);border-radius:50%;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.btn{width:60px;height:60px;background:rgba(255,255,255,.15);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px}</style></head><body><div id="start-screen"><h1>ZenCraft</h1><button id="load-world-button">üåé Start Exploring</button></div><div id="hud">ZenCraft v1.1</div><div id="notification"></div><div id="controls-ui"><div style="width:120px;height:120px;position:relative"><div class="joy-bg"></div><div class="joy-knob" id="joy-knob"></div></div><div style="display:flex;flex-direction:column;gap:15px"><div class="btn" id="btn-jump">‚¨ÜÔ∏è</div></div></div><script type="module">import*as T from'https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.module.js';class PN{constructor(){this.p=[];for(let i=0;i<256;i++)this.p[i]=Math.floor(Math.random()*256);this.p=[...this.p,...this.p]}fade(t){return t*t*t*(t*(t*6-15)+10)}lerp(t,a,b){return a+t*(b-a)}grad(h,x,y,z){const H=h&15,u=H<8?x:y,v=H<4?y:H==12||H==14?x:z;return((H&1)==0?u:-u)+((H&2)==0?v:-v)}noise(x,y,z){let X=Math.floor(x)&255,Y=Math.floor(y)&255,Z=Math.floor(z)&255;x-=Math.floor(x);y-=Math.floor(y);z-=Math.floor(z);let u=this.fade(x),v=this.fade(y),w=this.fade(z);let A=this.p[X]+Y,AA=this.p[A]+Z,AB=this.p[A+1]+Z,B=this.p[X+1]+Y,BA=this.p[B]+Z,BB=this.p[B+1]+Z;return this.lerp(w,this.lerp(v,this.lerp(u,this.grad(this.p[AA],x,y,z),this.grad(this.p[BA],x-1,y,z)),this.lerp(u,this.grad(this.p[AB],x,y-1,z),this.grad(this.p[BB],x-1,y-1,z))),this.lerp(v,this.lerp(u,this.grad(this.p[AA+1],x,y,z-1),this.grad(this.p[BA+1],x-1,y,z-1)),this.lerp(u,this.grad(this.p[AB+1],x,y-1,z-1),this.grad(this.p[BB+1],x-1,y-1,z-1))))}}const N=new PN(),CS=16,WH=128,B={E:0,S:1,D:2,G:3,W:4},C={1:0x5a5a5a,2:0x6e4e2a,3:0x1f7a45,4:0x2a9d8f},iM=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent),PH=1.8,PW=.3,iP={x:0,y:80,z:0},h=document.getElementById('hud'),n=document.getElementById('notification'),jB=document.getElementById('btn-jump'),cU=document.getElementById('controls-ui');if(iM)cU.style.display='flex';const P={pos:new T.Vector3(iP.x,iP.y,iP.z),vel:new T.Vector3(),yaw:0,pitch:0},S=new T.Scene(),SC=0x87ceeb;S.background=new T.Color(SC);S.fog=new T.Fog(SC,1,CS*(CS/2));const Cam=new T.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),R=new T.WebGLRenderer({antialias:1});R.setSize(innerWidth,innerHeight);document.body.appendChild(R.domElement);S.add(new T.HemisphereLight(0xffffff,0x404040,1.5));let dl=new T.DirectionalLight(0xffffff,1.2);dl.position.set(100,200,100);S.add(dl);class Chunk{constructor(x,z){this.x=x;this.z=z;this.k=x+','+z;this.b=new Uint8Array(CS*WH*CS);this.g=new T.Group();this.d=1;this.gen()}i(x,y,z){return x+CS*(z+CS*y)}gb(x,y,z){if(x<0||x>=CS||z<0||z>=CS||y<0||y>=WH)return 0;return this.b[this.i(x,y,z)]}sb(x,y,z,v){if(x>=0&&x<CS&&z>=0&&z<CS&&y>=0&&y<WH){this.b[this.i(x,y,z)]=v;this.d=1}}gen(){const wx=this.x*CS,wz=this.z*CS,sl=60;for(let x=0;x<CS;x++)for(let z=0;z<CS;z++){const gx=wx+x,gz=wz+z;let h=N.noise(gx/50,gz/50,0)*15+N.noise(gx/20,gz/20,0)*5+N.noise(gx/8,gz/8,0)*2;let th=Math.floor(h+70);for(let y=0;y<WH;y++){let bt=0;if(y<th-4)bt=1;else if(y<th)bt=2;else if(y==th)bt=3;if(y<=sl&&y<th){if(y==th-1&&th>sl)bt=3;else if(y<sl-1)bt=1;else if(y==sl-1)bt=2}else if(y<=sl)bt=4;this.sb(x,y,z,bt)}}this.d=1}vis(){const v=[];for(let y=0;y<WH;y++)for(let z=0;z<CS;z++)for(let x=0;x<CS;x++){let id=this.gb(x,y,z);if(id&&((id==4)||this.gb(x+1,y,z)==0||this.gb(x-1,y,z)==0||this.gb(x,y+1,z)==0||this.gb(x,y-1,z)==0||this.gb(x,y,z+1)==0||this.gb(x,y,z-1)==0))v.push({x,y,z,id})}return v}upd(){if(!this.d)return;this.d=0;this.g.children.forEach(c=>{c.geometry?.dispose();c.material?.dispose()});this.g.clear();const v=this.vis(),box=new T.BoxGeometry(1,1,1),m=new T.Matrix4(),b={};for(const{o,x,y,z,id}of v){const c=C[id]||0xffffff;(b[c]=b[c]||[]).push({x,y,z})}for(const c in b){const p=b[c],w=parseInt(c)==C[4];const mat=new T.MeshStandardMaterial({color:+c,roughness:.8,metalness:.1,transparent:w,opacity:w?.8:1}),mesh=new T.InstancedMesh(box,mat,p.length);for(let i=0;i<p.length;i++){let{x,y,z}=p[i];m.makeTranslation(this.x*CS+x+.5,y+.5,this.z*CS+z+.5);mesh.setMatrixAt(i,m)}mesh.instanceMatrix.needsUpdate=1;this.g.add(mesh)}}}class World{constructor(s){this.s=s;this.c=new Map();this.rd=4}k(x,z){return x+','+z}gb(wx,wy,wz){const cx=Math.floor(wx/CS),cz=Math.floor(wz/CS),lx=Math.floor(wx%CS+CS)%CS,lz=Math.floor(wz%CS+CS)%CS,k=this.k(cx,cz);return this.c.has(k)?this.c.get(k).gb(lx,Math.floor(wy),lz):0}upd(p){const cx=Math.floor(p.x/CS),cz=Math.floor(p.z/CS),need=new Set();for(let i=-this.rd;i<=this.rd;i++)for(let j=-this.rd;j<=this.rd;j++){let x=cx+i,z=cz+j,k=this.k(x,z);need.add(k);if(!this.c.has(k)){let nc=new Chunk(x,z);this.c.set(k,nc);this.s.add(nc.g)}this.c.get(k).upd()}for(const k of this.c.keys())if(!need.has(k)){let c=this.c.get(k);c.g.children.forEach(gc=>{gc.geometry?.dispose();gc.material?.dispose()});this.s.remove(c.g);this.c.delete(k)}}}const W=new World(S);const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));function note(m){n.innerText=m;n.style.opacity=1;setTimeout(()=>n.style.opacity=0,3e3)}function collide(w,x,y,z,r){const o=r*.9,p=[[x+o,z+o],[x+o,z-o],[x-o,z+o],[x-o,z-o],[x,z]],ch=[Math.floor(y-PH+.01),Math.floor(y-PH+PH*.7)];for(const[a,b]of p)for(const c of ch)if(w.gb(a,c,b)>0&&w.gb(a,c,b)!=4)return 1;return 0}const joy=document.getElementById('joy-knob');let jS={a:!1,id:0,sx:0,sy:0},gs={jx:0,jz:0,j:!1},lookA=document.getElementById('controls-ui');jB.ontouchstart=e=>{gs.j=1;e.preventDefault()};jB.ontouchend=e=>{gs.j=0;e.preventDefault()};function joyMove(t){let dx=t.clientX-jS.sx,dy=t.clientY-jS.sy,m=40;dx=clamp(dx,-m,m);dy=clamp(dy,-m,m);joy.style.transform=`translate(${dx}px,${dy}px)`;gs.jx=dx/m;gs.jz=-dy/m}cU.ontouchstart=e=>{let t=e.touches[0];jS={a:1,id:t.identifier,sx:t.clientX,sy:t.clientY};e.preventDefault()};cU.ontouchmove=e=>{for(const t of e.touches)if(t.identifier==jS.id){joyMove(t);e.preventDefault()}};cU.ontouchend=e=>{gs.jx=gs.jz=0;joy.style.transform='translate(-50%,-50%)'};if(!iM){addEventListener('keydown',e=>{if(e.code=='Space')gs.j=1;if(e.code=='KeyW')gs.jz=1;if(e.code=='KeyS')gs.jz=-1;if(e.code=='KeyA')gs.jx=-1;if(e.code=='KeyD')gs.jx=1});addEventListener('keyup',e=>{if(e.code=='Space')gs.j=0;if(['KeyW','KeyS'].includes(e.code))gs.jz=0;if(['KeyA','KeyD'].includes(e.code))gs.jx=0});addEventListener('click',()=>document.body.requestPointerLock?.());function mm(e){if(document.pointerLockElement===document.body){P.yaw-=e.movementX*.002;P.pitch-=e.movementY*.002;P.pitch=clamp(P.pitch,-Math.PI/2+.01,Math.PI/2-.01)}}addEventListener('pointerlockchange',()=>{if(document.pointerLockElement===document.body)addEventListener('mousemove',mm);else removeEventListener('mousemove',mm)})}let lt=0,onG=0;function loop(t){requestAnimationFrame(loop);const d=(t-lt)/1e3;lt=t;W.upd(P.pos);const sp=4*d,gr=15*d,jp=6,f=.8;h.innerText=`ZenCraft v1.1\nX:${P.pos.x.toFixed(1)} Y:${P.pos.y.toFixed(1)} Z:${P.pos.z.toFixed(1)}\nChunks:${W.c.size}`;const fw=new T.Vector3(Math.sin(P.yaw),0,Math.cos(P.yaw)),rg=new T.Vector3().crossVectors(fw,new T.Vector3(0,1,0)),tv=new T.Vector3();tv.addScaledVector(fw,-gs.jz*sp);tv.addScaledVector(rg,gs.jx*sp);P.vel.x=P.vel.x*f+tv.x;P.vel.z=P.vel.z*f+tv.z;P.vel.y-=gr;P.vel.y=Math.max(P.vel.y,-30*d);let nY=P.pos.y+P.vel.y*d;if(P.vel.y<0){if(collide(W,P.pos.x,nY,P.pos.z,PW)){while(!collide(W,P.pos.x,P.pos.y-0.05,P.pos.z,PW))P.pos.y-=.05;P.vel.y=0;onG=1}else{P.pos.y=nY;onG=0}}else if(P.vel.y>0){if(collide(W,P.pos.x,nY,P.pos.z,PW))P.vel.y=0;else P.pos.y=nY;onG=0}else P.pos.y=nY;if(!onG&&P.vel.y<=.01&&W.gb(P.pos.x,P.pos.y-PH-.1,P.pos.z))onG=1;if(gs.j&&onG){P.vel.y=jp*.8;onG=0;if(!iM)gs.j=0}let nX=P.pos.x+P.vel.x*d,nZ=P.pos.z+P.vel.z*d;if(P.vel.x&&collide(W,nX,P.pos.y,P.pos.z,PW)){P.vel.x=0;nX=P.pos.x}if(P.vel.z&&collide(W,P.pos.x,P.pos.y,nZ,PW)){P.vel.z=0;nZ=P.pos.z}P.pos.x=nX;P.pos.z=nZ;if(P.pos.y<-30){P.pos.set(iP.x,iP.y,iP.z);P.vel.set(0,0,0);note('Reset to spawn!');onG=0}const dir=new T.Vector3(Math.sin(P.yaw)*Math.cos(P.pitch),Math.sin(P.pitch),Math.cos(P.yaw)*Math.cos(P.pitch));Cam.position.copy(P.pos).add(new T.Vector3(0,PH-.2,0));Cam.lookAt(P.pos.clone().add(new T.Vector3(0,PH-.2,0)).add(dir.multiplyScalar(5)));R.render(S,Cam)}onresize=()=>{Cam.aspect=innerWidth/innerHeight;Cam.updateProjectionMatrix();R.setSize(innerWidth,innerHeight)};document.getElementById('load-world-button').onclick=()=>{document.getElementById('start-screen').style.display='none';lt=performance.now();loop(lt);note('World Loaded!')}</script></body></html>
