<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>ZenCraft</title><meta name="viewport" content="width=device-width,initial-scale=1"/><style>html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:sans-serif;color:#fff}canvas{display:block}#hud{position:fixed;left:10px;top:10px;z-index:60;background:rgba(0,0,0,.5);padding:8px 12px;border-radius:8px;font-family:monospace;font-size:13px}#notification{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#a8dadc;color:#1d3557;padding:10px 20px;border-radius:10px;font-weight:700;opacity:0;transition:opacity .4s;z-index:99}#inventory{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:60}#inventory div{width:50px;height:50px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:20px}#inventory .sel{border:2px solid #a8dadc;background:rgba(255,255,255,.2)}#controls{position:fixed;bottom:0;left:0;right:0;display:none;justify-content:space-between;padding:20px}.joy-bg{width:120px;height:120px;background:rgba(255,255,255,.05);border-radius:50%}.joy-knob{width:40px;height:40px;background:rgba(255,255,255,.25);border-radius:50%;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.btn{width:60px;height:60px;background:rgba(255,255,255,.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px}</style></head><body><div id="hud">ZenCraft</div><div id="notification"></div><div id="inventory"><div class="sel">ü™®</div><div>üåø</div><div>üíß</div></div><div id="controls"><div style="position:relative"><div class="joy-bg"></div><div class="joy-knob" id="joy"></div></div><div class="btn" id="jump">‚¨ÜÔ∏è</div></div><script type="module">import*as T from'https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.module.js';class N{constructor(){this.p=[];for(let i=0;i<256;i++)this.p[i]=Math.floor(Math.random()*256);this.p=[...this.p,...this.p]}f(t){return t*t*t*(t*(t*6-15)+10)}l(t,a,b){return a+t*(b-a)}g(h,x,y,z){const H=h&15,u=H<8?x:y,v=H<4?y:H==12||H==14?x:z;return((H&1)==0?u:-u)+((H&2)==0?v:-v)}n(x,y,z){let X=Math.floor(x)&255,Y=Math.floor(y)&255,Z=Math.floor(z)&255;x-=Math.floor(x);y-=Math.floor(y);z-=Math.floor(z);let u=this.f(x),v=this.f(y),w=this.f(z);let A=this.p[X]+Y,AA=this.p[A]+Z,AB=this.p[A+1]+Z,B=this.p[X+1]+Y,BA=this.p[B]+Z,BB=this.p[B+1]+Z;return this.l(w,this.l(v,this.l(u,this.g(this.p[AA],x,y,z),this.g(this.p[BA],x-1,y,z)),this.l(u,this.g(this.p[AB],x,y-1,z),this.g(this.p[BB],x-1,y-1,z))),this.l(v,this.l(u,this.g(this.p[AA+1],x,y,z-1),this.g(this.p[BA+1],x-1,y,z-1)),this.l(u,this.g(this.p[AB+1],x,y-1,z-1),this.g(this.p[BB+1],x-1,y-1,z-1))))}}const Pn=new N(),CS=16,WH=128,B={E:0,S:1,D:2,G:3,W:4},C={1:0x5a5a5a,2:0x6e4e2a,3:0x1f7a45,4:0x2a9d8f},PH=1.8,PW=.3,SP=6,iM=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent),hud=document.getElementById('hud'),note=document.getElementById('notification'),jumpB=document.getElementById('jump'),joy=document.getElementById('joy'),ctrl=document.getElementById('controls');if(iM)ctrl.style.display='flex';const ply={p:new T.Vector3(0,85,0),v:new T.Vector3(),yaw:0,pitch:0},scn=new T.Scene();scn.background=new T.Color(0x87ceeb);scn.fog=new T.Fog(0x87ceeb,1,300);const cam=new T.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),r=new T.WebGLRenderer({antialias:1});r.setSize(innerWidth,innerHeight);document.body.appendChild(r.domElement);scn.add(new T.HemisphereLight(0xffffff,0x404040,1.3));const dl=new T.DirectionalLight(0xffffff,1);dl.position.set(100,200,100);scn.add(dl);class Ch{constructor(x,z){this.x=x;this.z=z;this.k=x+','+z;this.b=new Uint8Array(CS*WH*CS);this.g=new T.Group();this.d=1;this.gen()}i(x,y,z){return x+CS*(z+CS*y)}gb(x,y,z){if(x<0||x>=CS||z<0||z>=CS||y<0||y>=WH)return 0;return this.b[this.i(x,y,z)]}sb(x,y,z,v){if(x>=0&&x<CS&&z>=0&&z<CS&&y>=0&&y<WH)this.b[this.i(x,y,z)]=v}gen(){const wx=this.x*CS,wz=this.z*CS,sl=60;for(let x=0;x<CS;x++)for(let z=0;z<CS;z++){const gx=wx+x,gz=wz+z;let h=Pn.n(gx/50,gz/50,0)*15+Pn.n(gx/20,gz/20,0)*5+Pn.n(gx/8,gz/8,0)*2;let th=Math.floor(h+70);for(let y=0;y<WH;y++){let bt=0;if(y<th-4)bt=1;else if(y<th)bt=2;else if(y==th)bt=3;if(y<=sl&&y<th){if(y==th-1&&th>sl)bt=3;else if(y<sl-1)bt=1;else if(y==sl-1)bt=2}else if(y<=sl)bt=4;this.sb(x,y,z,bt)}}this.d=1}vis(){const v=[];for(let y=0;y<WH;y++)for(let z=0;z<CS;z++)for(let x=0;x<CS;x++){let id=this.gb(x,y,z);if(id&&((id==4)||this.gb(x+1,y,z)==0||this.gb(x-1,y,z)==0||this.gb(x,y+1,z)==0||this.gb(x,y-1,z)==0||this.gb(x,y,z+1)==0||this.gb(x,y,z-1)==0))v.push({x,y,z,id})}return v}upd(){if(!this.d)return;this.d=0;this.g.clear();const v=this.vis(),box=new T.BoxGeometry(1,1,1),m=new T.Matrix4(),b={};for(const{ x,y,z,id}of v){const c=C[id]||0xffffff;(b[c]=b[c]||[]).push({x,y,z})}for(const c in b){const p=b[c],w=+c==C[4];const mat=new T.MeshStandardMaterial({color:+c,roughness:.8,metalness:.1,transparent:w,opacity:w?.8:1}),mesh=new T.InstancedMesh(box,mat,p.length);for(let i=0;i<p.length;i++){let{x,y,z}=p[i];m.makeTranslation(this.x*CS+x+.5,y+.5,this.z*CS+z+.5);mesh.setMatrixAt(i,m)}mesh.instanceMatrix.needsUpdate=1;this.g.add(mesh)}}}class W{constructor(s){this.s=s;this.c=new Map();this.rd=4}k(x,z){return x+','+z}gb(wx,wy,wz){const cx=Math.floor(wx/CS),cz=Math.floor(wz/CS),lx=Math.floor(wx%CS+CS)%CS,lz=Math.floor(wz%CS+CS)%CS,k=this.k(cx,cz);return this.c.has(k)?this.c.get(k).gb(lx,Math.floor(wy),lz):0}upd(p){const cx=Math.floor(p.x/CS),cz=Math.floor(p.z/CS),need=new Set();for(let i=-this.rd;i<=this.rd;i++)for(let j=-this.rd;j<=this.rd;j++){let x=cx+i,z=cz+j,k=this.k(x,z);need.add(k);if(!this.c.has(k)){let nc=new Ch(x,z);this.c.set(k,nc);this.s.add(nc.g)}this.c.get(k).upd()}for(const k of this.c.keys())if(!need.has(k)){let c=this.c.get(k);this.s.remove(c.g);this.c.delete(k)}}}const world=new W(scn),cl=(v,a,b)=>Math.max(a,Math.min(b,v));function col(w,x,y,z,r){const o=r*.9,p=[[x+o,z+o],[x+o,z-o],[x-o,z+o],[x-o,z-o],[x,z]],ch=[Math.floor(y-PH+.01),Math.floor(y-PH+PH*.7)];for(const[a,b]of p)for(const c of ch)if(w.gb(a,c,b)>0&&w.gb(a,c,b)!=4)return 1;return 0}function msg(m){note.innerText=m;note.style.opacity=1;setTimeout(()=>note.style.opacity=0,3e3)}let inpt={jx:0,jz:0,j:0},touch=null;if(iM){ctrl.ontouchstart=e=>{let t=e.touches[0];touch=t;e.preventDefault()};ctrl.ontouchmove=e=>{let t=e.touches[0];let dx=t.clientX-touch.clientX,dy=t.clientY-touch.clientY;ply.yaw-=dx*.005;ply.pitch-=dy*.005;ply.pitch=cl(ply.pitch,-Math.PI/2+.01,Math.PI/2-.01);touch=t;e.preventDefault()}}else{onkeydown=e=>{if(e.code=='Space')inpt.j=1;if(e.code=='KeyW')inpt.jz=1;if(e.code=='KeyS')inpt.jz=-1;if(e.code=='KeyA')inpt.jx=-1;if(e.code=='KeyD')inpt.jx=1};onkeyup=e=>{if(e.code=='Space')inpt.j=0;if(['KeyW','KeyS'].includes(e.code))inpt.jz=0;if(['KeyA','KeyD'].includes(e.code))inpt.jx=0};onclick=()=>document.body.requestPointerLock?.();function mm(e){if(document.pointerLockElement===document.body){ply.yaw-=e.movementX*.002;ply.pitch-=e.movementY*.002;ply.pitch=cl(ply.pitch,-Math.PI/2+.01,Math.PI/2-.01)}}onpointerlockchange=()=>{if(document.pointerLockElement===document.body)addEventListener('mousemove',mm);else removeEventListener('mousemove',mm)}}jumpB.ontouchstart=()=>inpt.j=1;jumpB.ontouchend=()=>inpt.j=0;let lt=0,onG=0;function loop(t){requestAnimationFrame(loop);const d=(t-lt)/1e3;lt=t;world.upd(ply.p);const sp=SP*d,gr=25*d,jp=7,f=.85;const fw=new T.Vector3(Math.sin(ply.yaw),0,Math.cos(ply.yaw)),rg=new T.Vector3().crossVectors(fw,new T.Vector3(0,1,0)),tv=new T.Vector3();tv.addScaledVector(fw,-inpt.jz*sp);tv.addScaledVector(rg,inpt.jx*sp);ply.v.x=ply.v.x*f+tv.x;ply.v.z=ply.v.z*f+tv.z;ply.v.y-=gr;let nY=ply.p.y+ply.v.y*d;if(ply.v.y<0){if(col(world,ply.p.x,nY,ply.p.z,PW)){while(!col(world,ply.p.x,ply.p.y-0.05,ply.p.z,PW))ply.p.y-=.05;ply.v.y=0;onG=1}else{ply.p.y=nY;onG=0}}else if(ply.v.y>0){if(col(world,ply.p.x,nY,ply.p.z,PW))ply.v.y=0;else ply.p.y=nY;onG=0}else ply.p.y=nY;if(inpt.j&&onG){ply.v.y=jp*.8;onG=0;if(!iM)inpt.j=0}let nX=ply.p.x+ply.v.x*d,nZ=ply.p.z+ply.v.z*d;if(ply.v.x&&col(world,nX,ply.p.y,ply.p.z,PW)){ply.v.x=0;nX=ply.p.x}if(ply.v.z&&col(world,ply.p.x,ply.p.y,nZ,PW)){ply.v.z=0;nZ=ply.p.z}ply.p.x=nX;ply.p.z=nZ;if(ply.p.y<-30){ply.p.set(0,85,0);ply.v.set(0,0,0);msg('Reset!');onG=0}hud.innerText=`ZenCraft v1.3\nX:${ply.p.x.toFixed(1)} Y:${ply.p.y.toFixed(1)} Z:${ply.p.z.toFixed(1)}\nChunks:${world.c.size}`;const dir=new T.Vector3(Math.sin(ply.yaw)*Math.cos(ply.pitch),Math.sin(ply.pitch),Math.cos(ply.yaw)*Math.cos(ply.pitch));cam.position.copy(ply.p).add(new T.Vector3(0,PH-.2,0));cam.lookAt(ply.p.clone().add(new T.Vector3(0,PH-.2,0)).add(dir.multiplyScalar(5)));r.render(scn,cam)}onresize=()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();r.setSize(innerWidth,innerHeight)};lt=performance.now();loop(lt);msg('World Loaded!')</script></body></html>
Loaded!')}</script></body></html>
